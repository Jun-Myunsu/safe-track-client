# PRD (Product Requirements Document)

# Safe Track - 실시간 위치 공유 안전 관리 앱

## 1. 제품 개요

### 1.1 제품 비전

Safe Track은 밤길 안전과 실시간 위치 공유를 통해 사용자의 안전을 보장하는 웹 기반 애플리케이션입니다. 친구 및 가족과 실시간으로 위치를 공유하고, AI 어시스턴트와 대화하며, 긴급 상황에서 빠르게 대응할 수 있는 기능을 제공합니다.

### 1.2 목표 사용자

- 밤늦게 귀가하는 직장인 및 학생
- 혼자 이동하는 여성 및 취약 계층
- 자녀의 안전을 확인하고 싶은 부모
- 친구/연인/가족의 위치를 실시간으로 확인하고 싶은 사용자

### 1.3 핵심 가치 제안

- **실시간 위치 공유**: GPS 기반 정확한 위치 추적 및 공유
- **1:N 안전 연결**: 기록이 남지 않고 앱을 설치해서 권한을 수락해야하는 번거러옴에서 해방
- **AI 동반자**: 혼자 있을 때 AI와 대화하며 심심풀이
- **긴급 대응**: 가짜 통화 기능으로 위험 상황 회피
- **직관적 UI**: 레트로 스타일의 직관적이며 사용하기 쉬운 인터페이스

---

## 2. 기능 요구사항

### 2.1 사용자 인증 및 관리

#### 2.1.1 회원가입

- **요구사항**: 사용자 ID와 비밀번호로 계정 생성
- **제약사항**:
  - ID는 4자 이상, 중복 불가
  - 비밀번호는 4자 이상
  - 실시간 ID 중복 체크 (300ms 디바운스)
- **성공 기준**: 계정 생성 후 자동 로그인 및 세션 생성

#### 2.1.2 로그인

- **요구사항**: ID/비밀번호 인증 또는 세션 기반 자동 로그인
- **제약사항**:
  - 세션 유효기간 7일
  - 잘못된 인증 정보 시 에러 메시지 표시
- **성공 기준**: 로그인 성공 시 메인 화면 진입 및 친구 목록 로드

#### 2.1.3 로그아웃

- **요구사항**: 세션 종료 및 모든 공유 상태 초기화
- **제약사항**: 로그아웃 시 위치 추적 자동 중지
- **성공 기준**: 로컬 스토리지 세션 정보 삭제 및 로그인 화면 이동

### 2.2 친구 관리

#### 2.2.1 친구 검색

- **요구사항**: 사용자 ID로 검색하여 친구 추가
- **제약사항**:
  - 존재하는 사용자만 검색 가능
  - 자기 자신은 추가 불가
- **성공 기준**: 검색 결과에 온라인 상태 및 추적 상태 표시

#### 2.2.2 친구 추가/삭제

- **요구사항**: 검색한 사용자를 친구 목록에 추가/삭제
- **제약사항**:
  - 이미 친구인 경우 중복 추가 불가
  - 친구 삭제 시 진행 중인 위치 공유 자동 중지
- **성공 기준**: 친구 목록에 실시간 반영 및 로컬 스토리지 저장

#### 2.2.3 친구 목록 조회

- **요구사항**: 추가된 친구 목록 표시 및 온라인/추적 상태 확인
- **제약사항**: 로그인 시 자동으로 친구 목록 로드
- **성공 기준**: 친구의 실시간 상태 업데이트 (온라인, 위치 추적 중)

### 2.3 위치 추적

#### 2.3.1 실시간 GPS 추적

- **요구사항**: Geolocation API를 사용한 실시간 위치 추적
- **제약사항**:
  - 위치 권한 필요
  - 정확도 우선 모드 (enableHighAccuracy: true)
  - 최대 대기 시간 10초, 캐시 사용 안 함
- **성공 기준**: 위치 변경 시 서버로 자동 전송 및 지도에 표시

#### 2.3.2 가상 위치 시뮬레이션

- **요구사항**: 테스트용 가상 이동 경로 (광주 시청 → 상무역)
- **제약사항**:
  - 실제 GPS와 동시 사용 불가
  - 보행 속도 1.4m/s, 2초마다 업데이트
  - 랜덤 변동 ±0.00005도
- **성공 기준**: 목적지 도착 시 자동 추적 중지

#### 2.3.3 위치 추적 중지

- **요구사항**: 사용자가 수동으로 위치 추적 중지
- **제약사항**:
  - 추적 중지 시 모든 위치 공유 자동 종료
  - 서버에 추적 중지 상태 전송
- **성공 기준**: 지도에서 내 위치 마커 제거 및 상태 업데이트

### 2.4 위치 공유

#### 2.4.1 위치 공유 요청

- **요구사항**: 친구에게 내 위치 공유 요청 전송
- **제약사항**:
  - 이미 공유 중인 경우 요청 불가
  - 중복 요청 방지 (대기 중인 요청 표시)
- **성공 기준**: 상대방에게 푸시 알림 및 음성 알림 전송

#### 2.4.2 위치 공유 수락/거부

- **요구사항**: 받은 위치 공유 요청에 대한 응답
- **제약사항**:
  - 이미 다른 사용자와 공유 중이면 자동 거부
  - 수락 시 양방향 위치 공유 시작
- **성공 기준**:
  - 수락: 양측 지도에 위치 표시 및 채팅 활성화
  - 거부: 요청자에게 거부 알림 전송

#### 2.4.3 위치 공유 중지

- **요구사항**: 진행 중인 위치 공유 종료
- **제약사항**:
  - 공유 중지 시 채팅 메시지 초기화
  - 상대방에게 중지 알림 전송
  - 위치 추적 자동 중지
- **성공 기준**: 양측 지도에서 상대방 위치 제거 및 채팅 비활성화

### 2.5 지도 기능

#### 2.5.1 다중 지도 타입

- **요구사항**: 4가지 지도 스타일 제공
  - 일반 지도 (OpenStreetMap)
  - 위성 지도 (Esri World Imagery)
  - 상세 지도 (OSM DE)
  - 지형 지도 (HOT OSM)
- **제약사항**: 한 번에 하나의 지도 타입만 표시
- **성공 기준**: 버튼 클릭으로 즉시 지도 타입 전환

#### 2.5.2 실시간 교통 정보

- **요구사항**: Google Traffic 레이어 표시
- **제약사항**: 투명도 70%로 지도와 혼합 표시
- **성공 기준**: 토글 버튼으로 교통 정보 표시/숨김

#### 2.5.3 응급시설 표시

- **요구사항**: 현재 지도 영역의 응급시설 표시
  - 병원 (🏥)
  - 경찰서 (🚔)
  - 파출소 (🛡️)
- **제약사항**:
  - Overpass API 사용 (OpenStreetMap 데이터)
  - 지도 이동 시 자동 재검색
  - 최대 응답 시간 25초
- **성공 기준**: 마커 클릭 시 시설명 및 좌표 표시

#### 2.5.4 위치 마커

- **요구사항**: 사용자 위치를 지도에 마커로 표시
- **제약사항**:
  - 내 위치: 빨간색 펄스 애니메이션 (📍)
  - 상대방 위치: 주황색 깜빡임 애니메이션 (🚶)
  - 각 사용자의 최신 위치만 표시
- **성공 기준**: 위치 업데이트 시 마커 자동 이동 및 지도 중심 조정

### 2.6 채팅

#### 2.6.1 실시간 1:N 채팅

- **요구사항**: 공유 중인 사용자와 실시간 채팅
- **제약사항**:
  - 공유 중인 사용자와만 채팅 가능
  - 양방향 메시지 전송
  - 엔터 키로 메시지 전송
- **성공 기준**:
  - 메시지 수신 시 푸시 알림 및 알림음
  - 채팅 히스토리 표시 (보낸 메시지/받은 메시지 구분)

#### 2.6.2 AI 채팅

- **요구사항**: 위치 공유 중이 아닐 때 AI와 대화
- **제약사항**:
  - OpenAI GPT-3.5-turbo 사용
  - 최대 토큰 300, 온도 0.7
  - 최근 10개 메시지만 컨텍스트로 사용
  - 현재 위치 정보 포함 (위치 추적 중일 때)
- **성공 기준**:
  - AI 응답 생성 (1-3초 이내)
  - API 오류 시 폴백 응답 제공
  - 대화 히스토리 유지

#### 2.6.3 채팅 히스토리

- **요구사항**: 현재 세션의 채팅 메시지 표시
- **제약사항**:
  - 위치 공유 종료 시 히스토리 초기화
  - 로그아웃 시 히스토리 삭제
- **성공 기준**: 스크롤 가능한 메시지 목록 표시

### 2.7 안전 기능

#### 2.7.1 가짜 통화 (SOS)

- **요구사항**: 긴급 상황 시 가짜 전화 화면 표시
- **제약사항**:
  - 전체 화면 모달로 표시
  - 통화 종료 버튼으로 닫기
- **성공 기준**:
  - 실제 통화 화면과 유사한 UI
  - 즉시 표시 및 닫기 가능

#### 2.7.2 음성 알림 (TTS)

- **요구사항**: 주요 이벤트 발생 시 음성으로 알림
- **제약사항**:
  - Web Speech API 사용
  - 사용자가 음성 알림 활성화/비활성화 가능
  - 한국어 음성 선택 가능
- **알림 이벤트**:
  - 위치 추적 시작/중지
  - 위치 공유 요청 수신
  - 위치 공유 수락/거부
  - 위치 공유 중지
  - 친구 추가
- **성공 기준**: 이벤트 발생 시 즉시 음성 재생

#### 2.7.3 푸시 알림

- **요구사항**: 브라우저 푸시 알림으로 중요 이벤트 알림
- **제약사항**:
  - Push Notification API 사용
  - 사용자 권한 필요
  - 로그인 시 권한 요청
- **알림 이벤트**:
  - 위치 공유 요청 수신
  - 위치 공유 수락
  - 새 메시지 수신
  - 친구 추가
- **성공 기준**: 알림 클릭 시 앱으로 포커스 이동

#### 2.7.4 라디오 플레이어

- **요구사항**: 배경 음악 재생 기능
- **제약사항**:
  - 사전 정의된 라디오 스트림 URL
  - 재생/일시정지 토글
- **성공 기준**: 버튼 클릭으로 음악 재생/중지

### 2.8 프로필 및 설정

#### 2.8.1 프로필 표시

- **요구사항**: 현재 로그인한 사용자 ID 표시
- **제약사항**: 프로필 섹션 토글로 표시/숨김
- **성공 기준**: 사용자 ID 및 설정 옵션 표시

#### 2.8.2 음성 설정

- **요구사항**: TTS 음성 활성화/비활성화 및 음성 선택
- **제약사항**:
  - 브라우저에서 지원하는 음성 목록 표시
  - 설정 변경 시 즉시 적용
- **성공 기준**: 선택한 음성으로 알림 재생

---

## 3. 비기능 요구사항

### 3.1 성능

- **응답 시간**:
  - 위치 업데이트 지연 < 2초
  - 채팅 메시지 전송 지연 < 1초
  - AI 응답 생성 < 3초
- **동시 사용자**: 최소 100명 동시 접속 지원
- **위치 정확도**: GPS 정확도 우선 모드 사용

### 3.2 보안

- **인증**:
  - 비밀번호 bcrypt 해싱 (salt rounds: 10)
  - 세션 ID 32바이트 랜덤 생성
  - 세션 유효기간 7일
- **데이터 보호**:
  - HTTPS 통신 (배포 환경)
  - CORS 정책 적용
  - SQL Injection 방지 (Parameterized Query)

### 3.3 가용성

- **서버 가동률**: 99% 이상
- **자동 재연결**:
  - 소켓 연결 끊김 시 자동 재연결
  - 세션 기반 자동 로그인
- **Keep-alive**:
  - 클라이언트: 5분마다 ping
  - 서버: 5분마다 자체 ping

### 3.4 확장성

- **데이터베이스**: PostgreSQL (관계형 데이터)
- **세션 관리**: 데이터베이스 기반 (메모리 대신)
- **위치 데이터**: 메모리 기반 (최근 50개 히스토리)

### 3.5 사용성

- **반응형 디자인**: 모바일/태블릿/데스크톱 지원
- **레트로 UI**: 친근하고 직관적인 게임 스타일 인터페이스
- **키보드 단축키**:
  - 엔터: 로그인/메시지 전송
  - ESC: 모달 닫기 (가짜 통화)

### 3.6 호환성

- **브라우저**: Chrome, Firefox, Safari, Edge (최신 2개 버전)
- **모바일**: iOS Safari, Android Chrome
- **API 지원**:
  - Geolocation API
  - Web Speech API
  - Push Notification API
  - LocalStorage

---

## 4. 사용자 시나리오

### 4.1 밤길 귀가 시나리오

1. 사용자 A가 로그인
2. 친구 B를 검색하여 친구 추가
3. 실시간 위치 추적 시작
4. 친구 B에게 위치 공유 요청
5. 친구 B가 수락
6. 양측 지도에 서로의 위치 표시
7. 채팅으로 "집에 잘 도착했어" 메시지 전송
8. 도착 후 위치 공유 중지

### 4.2 긴급 상황 시나리오

1. 사용자 A가 위험 상황 감지
2. SOS 버튼 클릭하여 가짜 통화 화면 표시
3. "여보세요? 네, 지금 가고 있어요" 연기
4. 위험 상황 회피 후 가짜 통화 종료
5. 친구 B에게 채팅으로 상황 공유

### 4.3 AI 동반자 시나리오

1. 사용자 A가 혼자 이동 중
2. 위치 추적 시작 (친구와 공유 안 함)
3. AI 채팅 창에서 "지금 어디야?" 질문
4. AI가 현재 위치 정보와 함께 응답
5. "밤길 안전 팁 알려줘" 요청
6. AI가 안전 관련 조언 제공

---

## 5. 제약사항 및 가정

### 5.1 제약사항

- 위치 히스토리는 메모리에만 저장 (영구 저장 안 함)
- AI 채팅은 OpenAI API 키 필요
- 실시간 교통 정보는 Google API 사용 (무료 제한)
- 응급시설 정보는 OpenStreetMap 데이터 의존

### 5.2 가정

- 사용자는 GPS 권한을 허용함
- 사용자는 안정적인 인터넷 연결 상태
- 사용자는 최신 브라우저 사용

---

## 6. 성공 지표

### 6.1 사용자 지표

- 일일 활성 사용자 (DAU)
- 평균 세션 시간
- 위치 공유 요청 수락률
- 친구 추가 수

### 6.2 기술 지표

- 서버 응답 시간 (평균 < 500ms)
- 위치 업데이트 성공률 (> 95%)
- 소켓 연결 안정성 (재연결 빈도)
- AI 응답 성공률 (> 90%)

### 6.3 안전 지표

- SOS 기능 사용 빈도
- 평균 위치 공유 시간
- 밤 시간대 사용률 (22:00-06:00)

---

## 7. 향후 개선 사항

### 7.1 단기 (1-3개월)

- 위치 히스토리 영구 저장 (DB)
- 그룹 위치 공유 (3-5명)
- 경로 기록 및 재생
- 안전 지역/위험 지역 표시

### 7.2 중기 (3-6개월)

- 모바일 앱 (React Native)
- 긴급 연락처 자동 알림
- 위치 기반 안전 점수
- 커뮤니티 안전 리포트

### 7.3 장기 (6-12개월)

- 머신러닝 기반 위험 예측
- 경찰/소방서 연동
- 보험사 제휴
- 국제화 (다국어 지원)

---

## 8. 부록

### 8.1 용어 정의

- **위치 추적**: GPS를 통한 실시간 위치 수집
- **위치 공유**: 다른 사용자에게 내 위치 전송
- **세션**: 로그인 상태 유지를 위한 인증 토큰
- **소켓**: 실시간 양방향 통신 연결

### 8.2 참고 자료

- Geolocation API: https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API
- Socket.IO: https://socket.io/docs/v4/
- Leaflet: https://leafletjs.com/
- OpenAI API: https://platform.openai.com/docs/

---

**문서 버전**: 1.0
**작성일**: 2025-10-23
**작성자**: Ailink - 전면수
