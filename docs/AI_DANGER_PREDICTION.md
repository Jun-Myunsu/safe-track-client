# AI 위험 예측 기능 사용 가이드

## 개요

OpenAI GPT-4를 활용하여 실시간 위치 추적 데이터를 분석하고 주변 위험 지역을 예측하는 기능입니다.

## 주요 특징

### 1. 실시간 위험 분석
- 현재 위치 기반 위험도 평가
- 시간대별 안전 고려사항 분석 (야간, 출퇴근 시간 등)
- 주변 응급시설 접근성 평가
- 이동 패턴 분석 (급격한 이동, 정체 등)

### 2. 시각화
- 지도에 위험 지역을 색상별로 표시
  - 🟢 낮은 주의 (Low): 노란색
  - 🟠 중간 주의 (Medium): 오렌지색
  - 🔴 높은 주의 (High): 빨간색
- 각 위험 지역에 대한 상세 정보 제공
- 실시간 안전 팁 표시

### 3. 정확성 보장
- **거짓 정보 방지**: AI는 실제 범죄 통계나 확인되지 않은 정보를 사용하지 않습니다
- **데이터 기반 분석**: 오직 제공된 실시간 데이터만을 기반으로 분석
  - 현재 시간대
  - 주변 응급시설 정보
  - 사용자 이동 패턴
  - 교통 상황
- **일반적인 안전 가이드라인**: 보편적으로 인정되는 안전 지침 제공

## 설치 및 설정

### 1. OpenAI API 키 발급
1. [OpenAI Platform](https://platform.openai.com/api-keys)에 접속
2. 계정 생성 또는 로그인
3. API Keys 메뉴에서 새 API 키 생성
4. API 키 복사 (한 번만 표시됩니다)

### 2. 환경 변수 설정
```bash
# .env 파일 생성
cp .env.example .env

# .env 파일 편집
VITE_OPENAI_API_KEY=sk-your-actual-api-key-here
```

### 3. 패키지 설치
```bash
npm install openai
```

## 사용 방법

### 1. 위치 추적 시작
1. 앱에 로그인
2. "📍 위치 추적" 또는 "🧪 테스트" 버튼 클릭

### 2. AI 위험 분석 활성화
1. 지도 오른쪽 상단의 "🤖" 버튼 클릭
2. AI가 자동으로 주변 환경 분석 시작
3. 30초마다 자동으로 업데이트

### 3. 위험 지역 확인
- 지도에 표시된 색상별 원형 영역 확인
- 원형 영역 클릭 시 상세 정보 팝업 표시
  - 위험 수준
  - 위험 이유
  - 권고사항
- 왼쪽 상단 안전 정보 패널에서 실시간 안전 팁 확인

## 기술 세부사항

### 사용 모델
- **GPT-4o-mini**: 빠른 응답 속도와 비용 효율성
- **Temperature: 0.3**: 일관성 있는 분석 결과
- **JSON Mode**: 구조화된 응답 형식

### 분석 주기
- 초기 분석: 🤖 버튼 클릭 시
- 자동 업데이트: 30초마다
- 위치 변경 시: 즉시 재분석

### 데이터 구조
```javascript
{
  overallRiskLevel: "low" | "medium" | "high",
  dangerZones: [
    {
      lat: 35.1595,
      lng: 126.8526,
      radius: 300,
      riskLevel: "medium",
      reason: "야간 시간대로 가시성이 낮음",
      recommendations: [
        "밝은 길로 이동하세요",
        "비상 연락처를 준비하세요"
      ]
    }
  ],
  safetyTips: [
    "주변을 주의 깊게 살피세요",
    "비상시 112에 연락하세요"
  ]
}
```

## 비용 안내

### OpenAI API 비용
- GPT-4o-mini 모델 사용
- 약 1,000회 분석당 $0.15 정도 (입력 토큰 기준)
- 30초마다 업데이트 시 시간당 120회 분석
- 실제 비용은 [OpenAI Pricing](https://openai.com/pricing)에서 확인

### 비용 절감 팁
1. 필요할 때만 🤖 버튼 활성화
2. 분석 주기를 더 길게 조정 (코드 수정 필요)
3. 테스트 시 API 키 미설정 → 기본 안전 팁만 표시

## 주의사항

### 안전 및 개인정보
- ✅ 위치 데이터는 OpenAI 서버로 전송됩니다
- ✅ OpenAI는 API 요청 데이터를 30일간 보관 (모델 학습에는 미사용)
- ✅ 민감한 개인 정보는 전송하지 않습니다
- ⚠️ API 키는 절대 공개 저장소에 업로드하지 마세요

### 분석 결과의 한계
- AI 분석은 **참고용**입니다
- 실제 범죄 발생률이나 통계 데이터가 아님
- 일반적인 안전 가이드라인을 제공
- 최종 판단은 사용자의 몫입니다

### 에러 처리
- API 키 미설정 시: 기본 안전 정보 표시
- API 호출 실패 시: 이전 분석 결과 유지 + 기본 안전 팁
- 네트워크 오류 시: 콘솔에 오류 로그 출력

## 문제 해결

### AI 분석이 작동하지 않는 경우
1. `.env` 파일에 `VITE_OPENAI_API_KEY` 확인
2. API 키가 유효한지 확인
3. OpenAI 계정에 크레딧이 있는지 확인
4. 브라우저 콘솔에서 에러 메시지 확인

### 위험 지역이 표시되지 않는 경우
1. 위치 추적이 활성화되어 있는지 확인
2. 🤖 버튼이 활성화(하이라이트)되어 있는지 확인
3. 안전 정보 패널에 "분석 중..." 표시 확인

## 향후 개선 사항
- [ ] 서버 사이드에서 API 호출 (API 키 보안 강화)
- [ ] 실제 범죄 통계 API 연동 (공공 데이터 활용)
- [ ] 사용자 피드백 기반 분석 정확도 개선
- [ ] 오프라인 모드 지원 (로컬 모델 사용)
- [ ] 다국어 지원

## 라이선스 및 크레딧
- OpenAI GPT-4o-mini 사용
- React Leaflet 지도 시각화
- OpenStreetMap 지도 데이터
